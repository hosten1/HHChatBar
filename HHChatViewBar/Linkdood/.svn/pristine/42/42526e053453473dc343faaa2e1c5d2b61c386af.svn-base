//
//  LDClient+Extend.m
//  SDKClient
//
//  Created by xiong qing on 16/4/20.
//  Copyright © 2016年 VRV. All rights reserved.
//

#import "LDClient+Extend.h"

@implementation LDClient (Extend)

#pragma mark 程序运行全局数据
//全局运行配置数据
- (void)instantiationClientConfig
{
    clientConfig = [[NSMutableDictionary alloc] initWithDictionary:[SDKClient getClientConfig]];
}

#pragma mark 登录帐号缓存
- (void)setupLoginConfig
{
    [SDKClient setLoginConfig:loginConfig];
}

- (void)loginSuccess{
    [self instantiationClientConfig];
    [self setupLoginConfig];
    
    //本地最近会话加载后再获取组织架构和密码复杂度
    [[LDClient sharedInstance] queryPasswordInfo];
    [[LDClient sharedInstance] queryOrganizationList];
}

- (void)queryPasswordInfo
{
    if (!passwordStipulate) {
        passwordStipulate = [[LDPasswordStipulateModel alloc] init];
        passwordStipulate.operType = AuthOperReset;
    }
    [passwordStipulate requestPasswordRule:nil];
}

- (void)queryOrganizationList
{
    [orgList queryOrganizationContent:nil completion:^(NSError *error) {
        if (error.code == err_sdk_srvUpdate) {
            [self queryOrganizationList];
        }
    }];
}

//清理数据
-(void)clearAccountInfo{
    loginConfig = [SDKClient getLoginConfig];
    mySelf = [[LDMyselfModel alloc] init];
    sysMessage = [[LDSysMsgModel alloc] init];
    passwordStipulate = [[LDPasswordStipulateModel alloc] init];
    [chatList clearItems];
    [contactList clearItems];
    [robotList clearItems];
    [groupList clearItems];
    [memberList clearItems];
    [orgList clearItems];
    [multiServers removeAllObjects];
    [self instantiationClientConfig];
}

@end
