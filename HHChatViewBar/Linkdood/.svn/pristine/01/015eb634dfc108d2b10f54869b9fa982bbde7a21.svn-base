//
//  LDNoteModelTest.m
//  Linkdood
//
//  Created by VRV2 on 16/6/12.
//  Copyright Â© 2016å¹´ xiong qing. All rights reserved.
//


#import <XCTest/XCTest.h>
#import "LDTextTool.h"
#import <SDKClient/SDKClient.h>


@interface LDNodeModelTest : XCTestCase
@property(nonatomic,strong)LDClient *client;
@property(nonatomic,strong)LDTextTool *utiles;
@property(nonatomic,strong) LDNoteListModel *noteList;
@end

@implementation LDNodeModelTest

- (void)setUp {
    [super setUp];
    
    LDClient *client =  [LDClient sharedInstance];
    _client = client;
    _utiles = [[LDTextTool alloc]init];
    _noteList = [[LDNoteListModel alloc]init];
}
/**
 *  åˆ›å»ºç½‘ç»œæ–‡æœ¬ç¬”è®°
 
 
 */
-(void)testAddNoteOfNodeListForText{
    __block BOOL done = NO;
    LDNoteModel *noteModel = [LDNoteModel buildWithTitle:@"æµ‹è¯•" content:@"ðŸ’—éœ€å‡ å¹´ï¼Œæ¨åªéœ€ä¸€ç§’" keyword:@"æƒ…æ„Ÿ" type:NOTE_TYPE_TEXT sourceType:NOTE_SOURCE_ONLINE];
    [_noteList addNote:noteModel completion:^(NSError *error) {
        XCTAssertTrue(!error,@"åˆ›å»ºç½‘ç»œæ–‡æœ¬ç¬”è®°å¤±è´¥");
        done = !error;
        
        
    }];
    XCTAssertTrue([self.utiles waitFor:&done timeout:3],
                  @"Timed out waiting for response asynch method completion");
}
/**
 *  åˆ›å»ºç½‘ç»œå›¾ç‰‡ç¬”è®°
 */
-(void)testAddNoteOfNodeListForImage{
    /*
     NOTE_TYPE_IMAGE = 2,
     NOTE_TYPE_AUDIO = 3,
     NOTE_TYPE_VIDEO = 4,
     NOTE_TYPE_URL = 5,
     */
    __block BOOL done = NO;
    LDNoteModel *noteModel = [LDNoteModel buildWithTitle:@"æµ‹è¯•" content:@"img.png" keyword:@"æƒ…æ„Ÿ" type:NOTE_TYPE_IMAGE sourceType:NOTE_SOURCE_ONLINE];
    [_noteList addNote:noteModel completion:^(NSError *error) {
        XCTAssertTrue(!error,@"åˆ›å»ºç½‘ç»œå›¾ç‰‡ç¬”è®°å¤±è´¥");
        done = !error;
        
        
    }];
    XCTAssertTrue([self.utiles waitFor:&done timeout:3],
                  @"Timed out waiting for response asynch method completion");
}
/**
 *  åˆ›å»ºæœ¬åœ°æ–‡æœ¬ç¬”è®°
 */
-(void)testAddNoteOfNodeListFortextLocal{
    /*
     NOTE_TYPE_IMAGE = 2,
     NOTE_TYPE_AUDIO = 3,
     NOTE_TYPE_VIDEO = 4,
     NOTE_TYPE_URL = 5,
     */
    __block BOOL done = NO;
    LDNoteModel *noteModel = [LDNoteModel buildWithTitle:@"æµ‹è¯•" content:@"haha,ceshi xiaoxi nihaoya " keyword:@"æƒ…æ„Ÿ" type:NOTE_TYPE_TEXT sourceType:NOTE_SOURCE_LOCAL];
    [_noteList addNote:noteModel completion:^(NSError *error) {
        XCTAssertTrue(!error,@"åˆ›å»ºç½‘ç»œå›¾ç‰‡ç¬”è®°å¤±è´¥");
        done = !error;
        
        
    }];
    XCTAssertTrue([self.utiles waitFor:&done timeout:3],
                  @"Timed out waiting for response asynch method completion");
}
/**
 * ç¼–è¾‘ç¬”è®°
 */
-(void)testEditNoteOfNodeList{
     __block BOOL done = NO;
   [_noteList queryNoteByBeginID:0 offset:30 flag:1 completion:^(NSError *error) {
       XCTAssertTrue(!error,@"æŸ¥è¯¢ç¬”è®°å¤±è´¥");
       
       if (!error && [_noteList numberOfItems] > 0) {
             NSMutableArray *deleteNoteModel = [NSMutableArray array];
             LDNoteModel *editNoteModel;
          for (NSInteger i = 0; i< [_noteList numberOfItems]; i++) {
              
               editNoteModel =(LDNoteModel*) [_noteList itemAtIndex:i];
               [deleteNoteModel addObject:[NSNumber numberWithLongLong:editNoteModel.ID]];
           }
           if (editNoteModel.type == NOTE_TYPE_TEXT) {
               editNoteModel.content = @"æµ‹è¯•å…¨éƒ¨çš„ä¿¡æ¯ ä¸ªäºº";
           }
           editNoteModel.title = @"è¿™æ˜¯æ¥è‡ªå•å…ƒæµ‹è¯•çš„æ ‡é¢˜";
           editNoteModel.title = @"å•å…ƒæµ‹è¯•";
          [_noteList editNote:editNoteModel  completion:^(NSError *error) {
         
              XCTAssertTrue(!error,@"ç¼–è¾‘ç¬”è®°å¤±è´¥");
              done = !error;
        
         }];

       }else{
           XCTAssertTrue([_noteList numberOfItems] > 0,@"æŸ¥è¯¢ç¬”è®°å¤±è´¥");
           done = YES;
       }
   }];
    XCTAssertTrue([self.utiles waitFor:&done timeout:3],
                  @"Timed out waiting for response asynch method completion");

}

/**
 *  åˆ é™¤ç¬”è®°
 */
-(void)testRemoveNoteOfNodeList{
    __block BOOL done = NO;
    [_noteList queryNoteByBeginID:0 offset:30 flag:1 completion:^(NSError *error) {
        XCTAssertTrue(!error,@"æŸ¥è¯¢ç¬”è®°å¤±è´¥");
        if (!error && [_noteList numberOfItems] > 0) {
            NSMutableArray *deleteNoteModel = [NSMutableArray array];
            LDNoteModel *DeleNoteModel;
            for (NSInteger i = 0; i< [_noteList numberOfItems]; i++) {
                
                DeleNoteModel =(LDNoteModel*) [_noteList itemAtIndex:i];
                [deleteNoteModel addObject:[NSNumber numberWithLongLong:DeleNoteModel.ID]];
                if (i > 1) {
                    break;
                }
            }
            [_noteList deleteNotes:deleteNoteModel completion:^(NSError *error) {
                
                XCTAssertTrue(!error,@"åˆ é™¤ç¬”è®°å¤±è´¥");
                done = !error;
                
            }];
            
        }else{
            XCTAssertTrue([_noteList numberOfItems] > 0,@"æŸ¥è¯¢ç¬”è®°å¤±è´¥");
            done = YES;
        }
    }];
    XCTAssertTrue([self.utiles waitFor:&done timeout:3],
                  @"Timed out waiting for response asynch method completion");
}
/**
 * æŸ¥è¯¢è®°äº‹æœ¬ å…¨éƒ¨çš„
 */
-(void)testQueryNoteOfNodeList{
    __block BOOL done = NO;
    [_noteList queryNoteByBeginID:0 offset:30 flag:1 completion:^(NSError *error) {
        XCTAssertTrue(!error,@"æŸ¥è¯¢ç¬”è®°å¤±è´¥");
        
        if (!error && [_noteList numberOfItems] > 0) {
                XCTAssertTrue([_noteList numberOfItems] == 3,@"æŸ¥è¯¢çš„è®°äº‹æœ¬æ¡æ•° é”™è¯¯");
                done = !error;
            
        }else{
            XCTAssertTrue([_noteList numberOfItems] > 0,@"æŸ¥è¯¢ç¬”è®°å¤±è´¥");
            done = YES;
        }
    }];
    XCTAssertTrue([self.utiles waitFor:&done timeout:3],
                  @"Timed out waiting for response asynch method completion");
    
}

- (void)testPerformanceExample {
    // This is an example of a performance test case.
    [self measureBlock:^{
        // Put the code you want to measure the time of here.
    }];
}

@end
